import { Exercise, ErrorType } from '@biomech/types';

/**
 * Библиотека упражнений для коррекции ошибок техники бега
 */
export const EXERCISE_LIBRARY: Exercise[] = [
  // Упражнения для коррекции асимметрии рук
  {
    id: 'ex001',
    name: 'Односторонние махи руками с гантелями',
    category: 'Работа рук',
    description: 'Встаньте прямо, возьмите лёгкую гантель в одну руку. Делайте маховые движения рукой вперёд-назад, как при беге — локоть согнут примерно под 90 градусов, мах от бедра до уровня груди. Выполняйте больше повторений на слабую руку, чтобы выровнять симметрию. Следите, чтобы плечо не поднималось вверх и корпус не разворачивался. Выполните 15–20 повторений на каждую руку в 3 подхода.',
    sets: 3,
    reps: '15-20 на каждую сторону',
    frequency: '3 раза в неделю',
    difficulty: 'Легко',
    target_errors: ['ARM_ASYMMETRY', 'INSUFFICIENT_ARM_DRIVE'],
  },
  {
    id: 'ex002',
    name: 'Планка с поочередным подъемом рук',
    category: 'Стабильность корпуса',
    description: 'Встаньте в позицию планки на прямых руках — тело прямое от головы до пяток, руки на ширине плеч. Медленно поднимите одну руку вперёд до уровня плеча и удержите 1–2 секунды, затем верните на место и повторите другой рукой. Важно: корпус не должен раскачиваться в стороны — напрягайте пресс и ягодицы на протяжении всего упражнения. Выполните 10–12 повторений на каждую руку в 3 подхода.',
    sets: 3,
    reps: '10-12 на каждую сторону',
    frequency: '4 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['ARM_ASYMMETRY', 'POOR_TRUNK_POSTURE'],
  },

  // Упражнения для коррекции асимметрии ног
  {
    id: 'ex003',
    name: 'Односторонние приседания (пистолетики)',
    category: 'Сила ног',
    description: 'Встаньте рядом со стулом или стеной для опоры. Перенесите вес на одну ногу, вторую слегка оторвите от пола. Медленно приседайте на опорной ноге, отводя таз назад — начинайте неглубоко, на 20–30 градусов. Следите, чтобы колено не заваливалось внутрь и не выходило далеко за носок. Постепенно от тренировки к тренировке увеличивайте глубину приседания. Выполните 8–10 повторений на каждую ногу в 3 подхода.',
    sets: 3,
    reps: '8-10 на каждую ногу',
    frequency: '2-3 раза в неделю',
    difficulty: 'Сложно',
    target_errors: ['LEG_ASYMMETRY'],
  },
  {
    id: 'ex004',
    name: 'Подъемы на носок на одной ноге',
    category: 'Голеностоп',
    description: 'Встаньте прямо рядом со стеной или спинкой стула для подстраховки. Перенесите вес на одну ногу, вторую слегка согните. Медленно поднимитесь на носок опорной ноги, удержите наверху 1–2 секунды и так же медленно опуститесь. Не торопитесь — весь смысл в контроле движения. Если легко, отойдите от опоры. Выполните 15–20 повторений на каждую ногу в 3 подхода.',
    sets: 3,
    reps: '15-20 на каждую ногу',
    frequency: '4 раза в неделю',
    difficulty: 'Легко',
    target_errors: ['LEG_ASYMMETRY'],
  },

  // Упражнения для стабильности колена
  {
    id: 'ex005',
    name: 'Стойка на одной ноге с закрытыми глазами',
    category: 'Баланс',
    description: 'Встаньте прямо, перенесите вес на одну ногу и оторвите вторую от пола. Закройте глаза и удерживайте равновесие от 30 до 60 секунд. Следите за тем, чтобы опорная нога была слегка согнута в колене — это помогает стабилизировать сустав. Руки можно держать вдоль тела или слегка развести в стороны для баланса. Затем смените ногу. Выполните 3 подхода на каждую сторону. Если упражнение даётся легко, встаньте на мягкую поверхность — сложенный коврик или подушку.',
    sets: 3,
    reps: '30-60 секунд на каждую ногу',
    frequency: 'Ежедневно',
    difficulty: 'Средне',
    target_errors: ['KNEE_INSTABILITY', 'LEG_ASYMMETRY'],
  },
  {
    id: 'ex006',
    name: 'Приседания с резиновой лентой вокруг колен',
    category: 'Сила ног',
    description: 'Встаньте прямо, ноги на ширине плеч, резиновая лента надета чуть выше колен. Носки слегка развёрнуты наружу. Опускайтесь вниз, сгибая колени и отводя таз назад — следите, чтобы колени двигались строго по линии носков и не заваливались внутрь: лента создаёт сопротивление и помогает держать правильное положение. Опускайтесь до угла 90 градусов в коленях, пятки плотно прижаты к полу, корпус держите прямо. Выполните 12–15 повторений в 3 подхода. Выполняйте 3 раза в неделю.',
    sets: 3,
    reps: '12-15',
    frequency: '3 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['KNEE_INSTABILITY'],
  },

  // Упражнения для стабильности корпуса
  {
    id: 'ex007',
    name: 'Мертвый жук (Dead Bug)',
    category: 'Стабильность корпуса',
    description: 'Лягте на спину на ровную поверхность. Поднимите руки вертикально вверх, согните ноги в коленях под углом 90 градусов — голени параллельны полу. Прижмите поясницу к полу и удерживайте её прижатой на протяжении всего упражнения. На выдохе медленно опустите правую руку назад за голову и одновременно вытяните левую ногу вперёд, почти касаясь пяткой пола. На вдохе вернитесь в исходное положение и повторите на другую сторону. Выполните 10–12 повторений на каждую сторону в 3 подхода.',
    sets: 3,
    reps: '10-12 на каждую сторону',
    frequency: '4 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['POOR_TRUNK_POSTURE', 'EXCESSIVE_VERTICAL_OSCILLATION'],
  },
  {
    id: 'ex008',
    name: 'Боковая планка с подъемом ноги',
    category: 'Стабильность корпуса',
    description: 'Лягте на бок, опираясь на предплечье — локоть под плечом, тело прямое от головы до пяток. Поднимитесь в боковую планку: бёдра оторваны от пола, тело составляет прямую линию. Удерживая это положение, медленно поднимайте верхнюю ногу вверх на 30–40 сантиметров и опускайте обратно. Не позволяйте бёдрам опускаться во время движения ногой. Выполните 8–10 повторений на каждую сторону в 3 подхода.',
    sets: 3,
    reps: '8-10 на каждую сторону',
    frequency: '3 раза в неделю',
    difficulty: 'Сложно',
    target_errors: ['POOR_TRUNK_POSTURE', 'LEG_ASYMMETRY'],
  },

  // Упражнения для уменьшения вертикальных колебаний
  {
    id: 'ex009',
    name: 'Бег на месте с минимальным подъемом',
    category: 'Техника бега',
    description: 'Встаньте прямо, ноги на ширине бёдер. Начните бежать на месте — но вместо высоких прыжков вверх делайте очень короткие, быстрые шаги, едва отрывая стопы от пола. Представьте, что пол горячий: касайтесь его как можно быстрее. Корпус держите прямо, руки работают как при обычном беге. Цель — научить ноги двигаться вперёд, а не вверх. Выполняйте 30–45 секунд в 5 подходах с отдыхом 30 секунд между ними.',
    sets: 5,
    reps: '30-45 секунд',
    frequency: '3 раза в неделю',
    difficulty: 'Легко',
    target_errors: ['EXCESSIVE_VERTICAL_OSCILLATION'],
  },
  {
    id: 'ex010',
    name: 'Прыжки на скакалке с низким подъемом',
    category: 'Техника бега',
    description: 'Возьмите скакалку и начните прыгать через неё, но с очень маленьким отрывом от земли — буквально 2–3 сантиметра. Главное не высота прыжка, а скорость касания: как только стопы коснулись земли, сразу же снова отталкивайтесь. Держите колени слегка согнутыми, приземляйтесь на переднюю часть стопы. Корпус прямой, взгляд вперёд. Это упражнение тренирует именно горизонтальное движение и убирает привычку прыгать вверх. Выполняйте 1–2 минуты в 4 подхода.',
    sets: 4,
    reps: '1-2 минуты',
    frequency: '3-4 раза в неделю',
    difficulty: 'Легко',
    target_errors: ['EXCESSIVE_VERTICAL_OSCILLATION'],
  },

  // Упражнения для улучшения осанки
  {
    id: 'ex011',
    name: 'Растяжка грудных мышц в дверном проеме',
    category: 'Гибкость',
    description: 'Встаньте в дверной проём, поднимите руки и согните их в локтях под углом 90 градусов — предплечья упираются в косяки двери, локти на уровне плеч или чуть выше. Сделайте небольшой шаг вперёд и мягко перенесите вес тела вперёд, пока не почувствуете растяжение в груди и передних дельтах. Удерживайте положение 30–45 секунд, дышите ровно. Не запрокидывайте голову назад. Выполните 3 подхода. Особенно полезно делать после долгого сидения за столом.',
    sets: 3,
    reps: '30-45 секунд',
    frequency: 'Ежедневно',
    difficulty: 'Легко',
    target_errors: ['POOR_TRUNK_POSTURE'],
  },
  {
    id: 'ex012',
    name: 'Упражнение "Супермен"',
    category: 'Сила спины',
    description: 'Лягте на живот на ровную поверхность, руки вытяните вперёд, ноги прямые. Одновременно оторвите от пола руки, грудь и ноги — тело принимает форму лодочки. Удержите верхнее положение 2–3 секунды, напрягая мышцы спины и ягодиц, затем медленно опуститесь. Не задерживайте дыхание. Смотрите вниз, не поднимайте голову — шея должна быть продолжением позвоночника. Выполните 12–15 повторений в 3 подхода с паузой 45 секунд между ними.',
    sets: 3,
    reps: '12-15',
    frequency: '3 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['POOR_TRUNK_POSTURE'],
  },

  // Упражнения для улучшения работы рук
  {
    id: 'ex013',
    name: 'Дрилл "Высокие колени с акцентом на руки"',
    category: 'Техника бега',
    description: 'Встаньте прямо, затем начните бег с высоким подниманием колен — каждое колено поднимайте до уровня бедра или выше. Одновременно следите за руками: локти согнуты под углом примерно 90 градусов, мах вперёд до уровня груди, назад до бедра. Руки и ноги работают в противофазе — правая нога вперёд, левая рука вперёд. Не горбитесь, корпус держите вертикально. Выполните 4 отрезка по 30–40 метров с ходьбой обратно в качестве отдыха.',
    sets: 4,
    reps: '30-40 метров',
    frequency: '2-3 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['INSUFFICIENT_ARM_DRIVE', 'ARM_ASYMMETRY'],
  },
  {
    id: 'ex014',
    name: 'Изометрическое удержание руки в беговой позиции',
    category: 'Выносливость рук',
    description: 'Возьмите лёгкие гантели (0.5–1 кг) и встаньте прямо. Согните руки в локтях под углом примерно 90 градусов и держите их в беговой позиции — одна рука впереди на уровне груди, другая сзади у бедра. Удерживайте это положение 45–60 секунд, не опуская руки и не разводя локти в стороны. Дышите ровно, плечи опущены и расслаблены. Затем поменяйте положение рук. Выполните 3 подхода. Упражнение укрепляет мышцы, отвечающие за правильную работу рук при беге.',
    sets: 3,
    reps: '45-60 секунд',
    frequency: '2 раза в неделю',
    difficulty: 'Средне',
    target_errors: ['INSUFFICIENT_ARM_DRIVE'],
  },

  // Универсальные упражнения
  {
    id: 'ex015',
    name: 'Бег с видеоанализом техники',
    category: 'Техника бега',
    description: 'Попросите кого-нибудь снять вас на видео во время бега — сбоку и сзади. Или установите телефон на штатив. Пробегите 2–3 отрезка по 100–150 метров в своём обычном темпе. После тренировки просмотрите видео: обратите внимание на положение корпуса, работу рук, симметрию шагов и то, насколько высоко вы прыгаете вверх. Сравнивайте с видео правильной техники бега. Записывайте наблюдения и отмечайте прогресс от недели к неделе. Делайте это раз в неделю на протяжении всего тренировочного цикла.',
    sets: 1,
    reps: '10-15 минут',
    frequency: '1 раз в неделю',
    difficulty: 'Легко',
    target_errors: ['ARM_ASYMMETRY', 'LEG_ASYMMETRY', 'POOR_TRUNK_POSTURE'],
  },
];

/**
 * Получить упражнения для конкретного типа ошибки
 */
export function getExercisesForError(errorType: ErrorType): Exercise[] {
  return EXERCISE_LIBRARY.filter(exercise =>
    exercise.target_errors.includes(errorType)
  );
}

/**
 * Получить упражнения для списка ошибок, отсортированные по релевантности
 */
export function getExercisesForErrors(errorTypes: ErrorType[]): Exercise[] {
  // Подсчитываем, сколько ошибок покрывает каждое упражнение
  const exerciseScores = EXERCISE_LIBRARY.map(exercise => {
    const matchCount = exercise.target_errors.filter(err =>
      errorTypes.includes(err)
    ).length;
    return { exercise, score: matchCount };
  });

  // Фильтруем только релевантные упражнения и сортируем по score
  return exerciseScores
    .filter(item => item.score > 0)
    .sort((a, b) => b.score - a.score)
    .map(item => item.exercise);
}
